{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\UI/assets\\Script\\UI\\SeatMgr.js"],"names":["cc","Class","extends","Component","properties","onLoad","cachedPlayersPos","cachedResultPos","cachedCardsPos","i","node","children","length","position","getChildByName","refreshSeats","Seats","seat","playerId","playerInfo","GameMgr","instance","getPlayer","onPlayerEnter","host","getHost","setHost","seatDisplay","getComponent","display","IsMyId","id","RotateSeats","mySeat","Notification","add","offset","movePosition","moveTo","runAction","cardsNode","resultNode","Layout","type","Type","VERTICAL","HORIZONTAL","log","angle","setPosition","onPlayerLeave","remove","getPlayerId","onTurnChange","startTime","timeout","displayTurn","disableCountDown","stopAllTurn","displayResult","playerWinId","playersCards","cards","bInstantWin","displayWinResult","displayLoseResult","hideResultIcon","RecallCards","onPlayerReady","isReady","setReady"],"mappings":"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","file":"SeatMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\UI","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n    },\r\n    \r\n    onLoad()\r\n    {\r\n        this.cachedPlayersPos = [];\r\n        this.cachedResultPos = [];\r\n        this.cachedCardsPos = [];\r\n        \r\n        for (let i=0; i<this.node.children.length; i++)\r\n        {\r\n            this.cachedPlayersPos[i] = this.node.children[i].position;\r\n            this.cachedResultPos[i] = this.node.children[i].getChildByName(\"display\").getChildByName(\"ResultIcon\").position;\r\n            this.cachedCardsPos[i] = this.node.children[i].getChildByName(\"display\").getChildByName(\"cards\").position;\r\n        }\r\n    },\r\n\r\n    refreshSeats(Seats)\r\n    {\r\n        for (var seat in Seats)\r\n        {\r\n            let playerId = Seats[seat];\r\n            if (playerId)\r\n            {\r\n                let playerInfo = GameMgr.instance.getPlayer(playerId);\r\n                this.onPlayerEnter(playerInfo, seat);\r\n            }\r\n        }\r\n        let host = GameMgr.instance.getHost();\r\n        if (host)\r\n            this.setHost(host);\r\n    },\r\n\r\n    onPlayerEnter(playerInfo, seat)\r\n    {\r\n        if (seat < this.node.children.length)\r\n        {\r\n            var seatDisplay = this.node.children[seat].getComponent(\"SeatDisplay\");\r\n                seatDisplay.display(playerInfo);\r\n        }\r\n        if (GameMgr.instance.IsMyId(playerInfo.id))\r\n        {\r\n            this.RotateSeats(seat);\r\n        }\r\n    },\r\n\r\n    RotateSeats(mySeat)\r\n    {\r\n        Notification.instance.add(\"Moving Player Position\");\r\n        for (let i=0; i < this.node.children.length; i++)\r\n        {\r\n            let offset = (i - mySeat) >= 0 ? (i - mySeat) : (i - mySeat + 4);\r\n            /*let fadeOut = cc.fadeOut(0.2);\r\n            let movePosition = cc.callFunc(() => this.node.children[i].position = this.cachedPlayersPos[offset]);\r\n            let fadeIn = cc.fadeIn(0.2);\r\n            this.node.children[i].runAction(cc.sequence(fadeOut, cc.delayTime(0.1), movePosition, fadeIn));*/\r\n            var movePosition = cc.moveTo(0.5,this.cachedPlayersPos[offset]);\r\n            this.node.children[i].runAction(movePosition);\r\n            var cardsNode = this.node.children[i].getChildByName(\"display\").getChildByName(\"cards\");\r\n            var resultNode = this.node.children[i].getChildByName(\"display\").getChildByName(\"ResultIcon\");\r\n            resultNode.getComponent(cc.Layout).type = offset % 2 ? cc.Layout.Type.VERTICAL : cc.Layout.Type.HORIZONTAL;\r\n            cc.log(resultNode.getComponent(cc.Layout).type);\r\n            cardsNode.angle = 90 * (offset % 2);\r\n            cardsNode.setPosition(this.cachedCardsPos[offset]);\r\n            resultNode.setPosition(this.cachedResultPos[offset]);\r\n        }\r\n    },\r\n\r\n    onPlayerLeave(seat)\r\n    {\r\n        if (seat < this.node.children.length)\r\n        {\r\n            var seatDisplay = this.node.children[seat].getComponent(\"SeatDisplay\");\r\n                seatDisplay.remove();\r\n        }\r\n    },\r\n\r\n    setHost(playerId)\r\n    {\r\n        for (var i=0; i<this.node.children.length; i++)\r\n        {\r\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\r\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\r\n            {\r\n                seatDisplay.setHost(true);\r\n            }\r\n            else\r\n            {\r\n                seatDisplay && seatDisplay.setHost(false);\r\n            }\r\n        }\r\n    },\r\n\r\n    onTurnChange(playerId, startTime, timeout)\r\n    {\r\n        for (var i=0; i<this.node.children.length; i++)\r\n        {\r\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\r\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\r\n            {\r\n                seatDisplay.displayTurn(startTime, timeout);\r\n            }\r\n            else\r\n            {\r\n                seatDisplay.disableCountDown();\r\n            }\r\n        }\r\n    },\r\n\r\n    stopAllTurn()\r\n    {\r\n        for (var i=0; i<this.node.children.length; i++)\r\n        {\r\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\r\n                seatDisplay.disableCountDown();\r\n        }\r\n    },\r\n\r\n    displayResult(playerWinId, playersCards)\r\n    {\r\n        for (var i=0; i<this.node.children.length; i++)\r\n        {\r\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\r\n            if (seatDisplay && seatDisplay.getPlayerId() != null)\r\n            {\r\n                var cards = playersCards[seatDisplay.getPlayerId()];\r\n                var bInstantWin = playersCards[playerWinId].length == 13;\r\n                if(seatDisplay.getPlayerId() == playerWinId)\r\n                {\r\n                    seatDisplay.displayWinResult(bInstantWin, cards);\r\n                }\r\n                else \r\n                {\r\n                    seatDisplay.displayLoseResult(bInstantWin, cards);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    hideResultIcon()\r\n    {\r\n        for (var i=0; i<this.node.children.length; i++)\r\n        {\r\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\r\n            seatDisplay.hideResultIcon();\r\n            if (seatDisplay && seatDisplay.getPlayerId() != null)\r\n            {\r\n                seatDisplay.RecallCards();\r\n            }\r\n        }\r\n    },\r\n\r\n    onPlayerReady(playerId, isReady)\r\n    {\r\n        for (var i=0; i<this.node.children.length; i++)\r\n        {\r\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\r\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\r\n            {\r\n                seatDisplay.setReady(isReady);\r\n            }\r\n        }\r\n    }\r\n    \r\n});\r\n"]}