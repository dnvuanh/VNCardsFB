{"version":3,"sources":["../../../../../assets/Script/UI/assets/Script/UI/SeatMgr.js"],"names":["cc","Class","extends","Component","properties","start","seats","GameMgr","instance","getCurrentSeats","seat","playerId","playerInfo","getPlayer","onPlayerEnter","host","getHost","setHost","cachedPlayersPos","i","node","children","length","position","seatDisplay","getComponent","display","IsMyId","id","RotateSeats","mySeat","offset","fadeOut","movePosition","callFunc","fadeIn","runAction","sequence","delayTime","onPlayerLeave","remove","getPlayerId","onTurnChange","startTime","timeout","displayTurn","disableCountDown","stopAllTurn","displayResult","playerWinId","playersCards","displayCards","log","enableResultIcon","hideResultIcon","RecallCards","onPlayerReady","isReady","setReady"],"mappings":"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","file":"SeatMgr.js","sourceRoot":"../../../../../assets/Script/UI","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n    \n    start()\n    {\n        let seats = GameMgr.instance.getCurrentSeats();\n        for (var seat in seats)\n        {\n            let playerId = seats[seat];\n            if (playerId)\n            {\n                let playerInfo = GameMgr.instance.getPlayer(playerId);\n                this.onPlayerEnter(playerInfo, seat);\n            }\n        }\n        let host = GameMgr.instance.getHost();\n        if (host)\n            this.setHost(host);\n\n        this.cachedPlayersPos = [];\n        for (let i=0; i<this.node.children.length; i++)\n        {\n            this.cachedPlayersPos[i] = this.node.children[i].position;\n        }\n    },\n\n    onPlayerEnter(playerInfo, seat)\n    {\n        if (seat < this.node.children.length)\n        {\n            var seatDisplay = this.node.children[seat].getComponent(\"SeatDisplay\");\n                seatDisplay.display(playerInfo);\n        }\n        if (GameMgr.instance.IsMyId(playerInfo.id))\n        {\n            this.RotateSeats(seat);\n        }\n    },\n\n    RotateSeats(mySeat)\n    {\n        for (let i=0; i < this.node.children.length; i++)\n        {\n            let offset = (i - mySeat) >= 0 ? (i - mySeat) : (i - mySeat + 4);\n            let fadeOut = cc.fadeOut(0.2);\n            let movePosition = cc.callFunc(() => this.node.children[i].position = this.cachedPlayersPos[offset]);\n            let fadeIn = cc.fadeIn(0.2);\n            this.node.children[i].runAction(cc.sequence(fadeOut, cc.delayTime(0.1), movePosition, fadeIn));\n            /*var movePosition = cc.moveTo(0.2,this.cachedPlayersPos[offset]);\n            this.node.children[i].runAction(movePosition);*/\n        }\n    },\n\n    onPlayerLeave(seat)\n    {\n        if (seat < this.node.children.length)\n        {\n            var seatDisplay = this.node.children[seat].getComponent(\"SeatDisplay\");\n                seatDisplay.remove();\n        }\n    },\n\n    setHost(playerId)\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\n            {\n                seatDisplay.setHost(true);\n            }\n            else\n            {\n                seatDisplay && seatDisplay.setHost(false);\n            }\n        }\n    },\n\n    onTurnChange(playerId, startTime, timeout)\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\n            {\n                seatDisplay.displayTurn(startTime, timeout);\n            }\n            else\n            {\n                seatDisplay.disableCountDown();\n            }\n        }\n    },\n\n    stopAllTurn()\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n                seatDisplay.disableCountDown();\n        }\n    },\n\n    displayResult(playerWinId, playersCards)\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n            if (seatDisplay && seatDisplay.getPlayerId() != null)\n            {\n                seatDisplay.displayCards(playersCards[seatDisplay.getPlayerId()]);\n                if(seatDisplay.getPlayerId() == playerWinId)\n                {\n                    cc.log(seatDisplay.getPlayerId());\n                    seatDisplay.enableResultIcon(true);\n                }\n            }\n        }\n    },\n\n    hideResultIcon()\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n            seatDisplay.enableResultIcon(false);\n            if (seatDisplay && seatDisplay.getPlayerId() != null)\n            {\n                seatDisplay.RecallCards();\n            }\n        }\n    },\n\n    onPlayerReady(playerId, isReady)\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\n            {\n                seatDisplay.setReady(isReady);\n            }\n        }\n    }\n    \n});\n"]}