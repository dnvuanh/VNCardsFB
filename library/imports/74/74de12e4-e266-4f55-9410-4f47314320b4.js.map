{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\UI/assets\\Script\\UI\\SeatMgr.js"],"names":["cc","Class","extends","Component","properties","SeatPrefab","Prefab","onLoad","cachedPlayersPos","Seats","i","node","children","length","position","instantiate","getComponent","active","onInit","addChild","seatOffset","refreshSeats","seat","playerId","playerInfo","GameMgr","instance","getPlayer","onPlayerEnter","host","getHost","setHost","seatDisplay","display","IsMyId","id","RotateSeats","mySeat","Notification","add","offset","movePosition","moveTo","runAction","setPositionAfterRotate","onPlayerLeave","remove","getPlayerId","onTurnChange","startTime","timeout","displayTurn","disableCountDown","stopAllTurn","onPlayerReady","isReady","setReady","getPlayerSeat","getPositionAfterRotate"],"mappings":"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","file":"SeatMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\UI","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        SeatPrefab : cc.Prefab,\n    },\n    \n    onLoad()\n    {\n        this.cachedPlayersPos = [];\n        this.Seats = [];\n        \n        for (let i=0; i<this.node.children.length; i++)\n        {\n            this.cachedPlayersPos[i] = this.node.children[i].position;\n            this.Seats[i] = cc.instantiate(this.SeatPrefab).getComponent(\"SeatDisplay\");\n            this.node.children[i].active = false;\n            this.Seats[i].onInit(i, this.cachedPlayersPos[i]);\n        }\n        for(let i = 0; i < 4; i++)\n        {\n            this.node.addChild(this.Seats[i].node);\n        }\n        this.seatOffset = 0;\n    },\n\n    refreshSeats(Seats)\n    {\n        for (var seat in Seats)\n        {\n            let playerId = Seats[seat];\n            if (playerId)\n            {\n                let playerInfo = GameMgr.instance.getPlayer(playerId);\n                this.onPlayerEnter(playerInfo, seat);\n            }\n        }\n        let host = GameMgr.instance.getHost();\n        if (host)\n            this.setHost(host);\n    },\n\n    onPlayerEnter(playerInfo, seat)\n    {\n        if (seat < this.Seats.length)\n        {\n            var seatDisplay = this.Seats[seat];\n                seatDisplay.display(playerInfo);\n        }\n        if (GameMgr.instance.IsMyId(playerInfo.id))\n        {\n            this.RotateSeats(seat);\n        }\n    },\n\n    RotateSeats(mySeat)\n    {\n        Notification.instance.add(\"Moving Player Position\");\n        for (let i=0; i < this.Seats.length; i++)\n        {\n            let offset = (i - mySeat) >= 0 ? (i - mySeat) : (i - mySeat + 4);\n            /*let fadeOut = cc.fadeOut(0.2);\n            let movePosition = cc.callFunc(() => this.Seats[i].node.position = this.cachedPlayersPos[offset]);\n            let fadeIn = cc.fadeIn(0.2);\n            this.Seats[i].node.runAction(cc.sequence(fadeOut, cc.delayTime(0.1), movePosition, fadeIn));*/\n            var movePosition = cc.moveTo(0.5,this.cachedPlayersPos[offset]);\n            this.Seats[i].node.runAction(movePosition);\n            this.Seats[i].setPositionAfterRotate(offset);\n        }\n    },\n\n    onPlayerLeave(seat)\n    {\n        if (seat < this.Seats.length)\n        {\n            var seatDisplay = this.Seats[seat];\n                seatDisplay.remove();\n        }\n    },\n\n    setHost(playerId)\n    {\n        for (var i=0; i<this.Seats.length; i++)\n        {\n            var seatDisplay = this.Seats[i];\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\n            {\n                seatDisplay.setHost(true);\n            }\n            else\n            {\n                seatDisplay && seatDisplay.setHost(false);\n            }\n        }\n    },\n\n    onTurnChange(playerId, startTime, timeout)\n    {\n        for (var i=0; i<this.Seats.length; i++)\n        {\n            var seatDisplay = this.Seats[i];\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\n            {\n                seatDisplay.displayTurn(startTime, timeout);\n            }\n            else\n            {\n                seatDisplay.disableCountDown();\n            }\n        }\n    },\n\n    stopAllTurn()\n    {\n        for (var i=0; i<this.Seats.length; i++)\n        {\n            var seatDisplay = this.Seats[i];\n                seatDisplay.disableCountDown();\n        }\n    },\n\n    onPlayerReady(playerId, isReady)\n    {\n        for (var i=0; i<this.Seats.length; i++)\n        {\n            var seatDisplay = this.Seats[i];\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\n            {\n                seatDisplay.setReady(isReady);\n            }\n        }\n    },\n\n    getPlayerSeat(playerId)\n    {\n        for (var i = 0; i < this.Seats.length; i++)\n        {\n            var seatDisplay = this.Seats[i];\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\n            {\n                return seatDisplay.getPositionAfterRotate();\n            }\n        }\n        return -1;\n    }\n    \n});\n"]}