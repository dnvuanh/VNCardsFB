{"version":3,"sources":["../../../../../assets/Script/Singleton/assets/Script/Singleton/ImageCache.js"],"names":["ImageCache","cc","Class","ctor","cachedImages","Init","callback","addRes","i","id","path","loader","loadRes","err","img","error","bind","load","URL","addImage","console","warn","getImage","loadAvatar","userId","photo","SpriteFrame","getSprite","module","exports"],"mappings":"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","file":"ImageCache.js","sourceRoot":"../../../../../assets/Script/Singleton","sourcesContent":["var ImageCache = cc.Class({\n\n    ctor() {\n        this.cachedImages = {};\n    },\n\n    Init(callback)\n    {\n        this.addRes(\"default\", \"Texture/default\");\n        for (var i=12; i<64; i++)\n            this.addRes(\"Card_\" + i, \"Texture/Cards/\" + \"Card_\" + i);\n        callback();\n    },\n\n    addRes(id, path) {\n        if (!this.cachedImages[id]) {\n            this.cachedImages[id] = path;\n            cc.loader.loadRes(path, ((err, img) => {\n                if (err) { cc.error(err); return; }\n                this.cachedImages[id] = img;\n            }).bind(this));\n        }\n    },\n\n    load(id, URL) {\n        if (!this.cachedImages[id]) {\n            this.cachedImages[id] = URL;\n            cc.loader.load(URL, ((err, img) => {\n                if (err) { cc.error(err); return; }\n                this.cachedImages[id] = img;\n            }).bind(this));\n        }\n    },\n\n    addImage(id, img)\n    {\n        if (!this.cachedImages[id])\n            this.cachedImages[id] = img;\n        else\n        {\n            console.warn(\"image with id \" + id + \" is already in cached list\");\n        }\n    },\n\n    getImage(id) {\n        if (!this.cachedImages[id]) {\n            console.error(\"Image id: \" + id + \" was not added to cached list\");\n            id = \"default\";\n        }\n        return this.cachedImages[id];\n    },\n\n    loadAvatar(userId, photo, callback)\n    {\n        if (photo == \"default\")\n        {\n            callback(new cc.SpriteFrame(this.cachedImages[photo]));\n        }\n        else if (this.cachedImages[userId])\n        {\n            callback(new cc.SpriteFrame(this.cachedImages[userId]));\n        }\n        else\n        {\n            cc.loader.load(photo, ((err, img) => {\n                if (err)\n                {\n                    callback(null);\n                }\n                this.cachedImages[userId] = img;\n                callback(new cc.SpriteFrame(this.cachedImages[userId]));\n            }).bind(this));\n        }\n    },\n\n    getSprite(id) {\n        return new cc.SpriteFrame(this.getImage(id));\n    },\n});\n\nmodule.exports = new ImageCache();"]}