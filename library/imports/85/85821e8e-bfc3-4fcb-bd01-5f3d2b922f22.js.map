{"version":3,"sources":["../../../../../assets/Script/Singleton/assets/Script/Singleton/ImageCache.js"],"names":["ImageCache","cc","Class","ctor","cachedImages","Init","callback","addRes","i","Sprites","id","path","loader","loadRes","err","img","error","bind","load","URL","addImage","console","warn","getImage","loadAvatar","userId","photo","SpriteFrame","getSprite","module","exports"],"mappings":"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","file":"ImageCache.js","sourceRoot":"../../../../../assets/Script/Singleton","sourcesContent":["var ImageCache = cc.Class({\r\n\r\n    ctor() {\r\n        this.cachedImages = {};\r\n    },\r\n\r\n    Init(callback)\r\n    {\r\n        this.addRes(\"default\", \"Texture/default\");\r\n        for (var i=12; i<64; i++)\r\n            this.addRes(\"Card_\" + i, \"Texture/Cards/\" + \"Card_\" + i);\r\n\r\n        this.addRes(\"Result_Win\", \"Texture/Result/first\");\r\n        this.addRes(\"Result_InstantWin\", \"Texture/Result/InstantWin\");\r\n        this.addRes(\"Result_Lose\", \"Texture/Result/lose\");\r\n        this.addRes(\"Result_Burned\", \"Texture/Result/burned\");\r\n        this.addRes(\"Result_Dead2\", \"Texture/Result/dead2\");\r\n        this.addRes(\"Result_Frozen\", \"Texture/Result/frozen\");\r\n\r\n        this.Sprites = {};\r\n        callback();\r\n    },\r\n\r\n    addRes(id, path) {\r\n        if (!this.cachedImages[id]) {\r\n            this.cachedImages[id] = path;\r\n            cc.loader.loadRes(path, ((err, img) => {\r\n                if (err) { cc.error(err); return; }\r\n                this.cachedImages[id] = img;\r\n            }).bind(this));\r\n        }\r\n    },\r\n\r\n    load(id, URL) {\r\n        if (!this.cachedImages[id]) {\r\n            this.cachedImages[id] = URL;\r\n            cc.loader.load(URL, ((err, img) => {\r\n                if (err) { cc.error(err); return; }\r\n                this.cachedImages[id] = img;\r\n            }).bind(this));\r\n        }\r\n    },\r\n\r\n    addImage(id, img)\r\n    {\r\n        if (!this.cachedImages[id])\r\n            this.cachedImages[id] = img;\r\n        else\r\n        {\r\n            console.warn(\"image with id \" + id + \" is already in cached list\");\r\n        }\r\n    },\r\n\r\n    getImage(id) {\r\n        if (!this.cachedImages[id]) {\r\n            console.error(\"Image id: \" + id + \" was not added to cached list\");\r\n            id = \"default\";\r\n        }\r\n        return this.cachedImages[id];\r\n    },\r\n\r\n    loadAvatar(userId, photo, callback)\r\n    {\r\n        if (photo == \"default\")\r\n        {\r\n            callback(new cc.SpriteFrame(this.cachedImages[photo]));\r\n        }\r\n        else if (this.cachedImages[userId])\r\n        {\r\n            callback(new cc.SpriteFrame(this.cachedImages[userId]));\r\n        }\r\n        else\r\n        {\r\n            cc.loader.load(photo, ((err, img) => {\r\n                if (err)\r\n                {\r\n                    callback(null);\r\n                }\r\n                this.cachedImages[userId] = img;\r\n                callback(new cc.SpriteFrame(this.cachedImages[userId]));\r\n            }).bind(this));\r\n        }\r\n    },\r\n\r\n    getSprite(id) {\r\n        if(this.Sprites[id] == null)\r\n        {\r\n            this.Sprites[id] = new cc.SpriteFrame(this.getImage(id));\r\n        }\r\n        return this.Sprites[id];\r\n    },\r\n});\r\n\r\nmodule.exports = new ImageCache();"]}