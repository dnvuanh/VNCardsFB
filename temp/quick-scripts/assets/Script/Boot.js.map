{"version":3,"sources":["Boot.js"],"names":["cc","Class","extends","Component","properties","loadingBar","ProgressBar","username","EditBox","login","Button","start","FBInstantHelper","isReady","node","active","startLoading","loginButtonPressed","loadResource","ImageCache","Init","InitGameSpark","bind","GSMgr","instance","LoginServer","progress","userId","string","authenticationRequest","OnTryLogin","response","error","playerName","getPlayerName","playerPhoto","getPlayerPhoto","registrationRequest","OnTryRegister","EnterRoom","groupId","getContextID","enterRoomRequest","onEnterRoomResponse","console","log","WaitMatchData","GameMgr","onMatchLoaded","LoadGameScene","director","preloadScene","Finished","loadScene"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,oBAAYL,GAAGM,WADP;AAERC,kBAAUP,GAAGQ,OAFL;AAGRC,eAAOT,GAAGU;AAHF,KAHP;;AASL;;AAEA;;AAEAC,SAbK,mBAaI;AACL,YAAGC,gBAAgBC,OAAhB,EAAH,EAA8B;AAC1B,iBAAKJ,KAAL,CAAWK,IAAX,CAAgBC,MAAhB,GAAyB,KAAzB;AACA,iBAAKR,QAAL,CAAcO,IAAd,CAAmBC,MAAnB,GAA4B,KAA5B;AACA,iBAAKC,YAAL;AACH;AACJ,KAnBI;AAqBLC,sBArBK,gCAqBgB;AACjB,aAAKD,YAAL;AACH,KAvBI;AAyBLA,gBAzBK,0BA0BL;AACI,aAAKE,YAAL;AACH,KA5BI;AA8BLA,gBA9BK,0BA+BL;AACIC,mBAAWC,IAAX,CAAgB,KAAKC,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAAhB;AACH,KAjCI;AAmCLD,iBAnCK,2BAoCL;AACIE,cAAMC,QAAN,CAAeJ,IAAf,CAAoB,KAAKK,WAAL,CAAiBH,IAAjB,CAAsB,IAAtB,CAApB;AACA,aAAKjB,UAAL,CAAgBqB,QAAhB,GAA2B,GAA3B;AACH,KAvCI;AAyCLD,eAzCK,yBA0CL;AACI,aAAKE,MAAL,GAAc,KAAKpB,QAAL,CAAcqB,MAA5B,CADJ,CACwC;AACpCL,cAAMC,QAAN,CAAeK,qBAAf,CAAqC,KAAKF,MAA1C,EAAkD,KAAKA,MAAvD,EAA+D,KAAKG,UAAL,CAAgBR,IAAhB,CAAqB,IAArB,CAA/D;AACH,KA7CI;AA+CLQ,cA/CK,sBA+CMC,QA/CN,EAgDL;AACI,YAAIA,SAASC,KAAb,EACA;AACI,gBAAIC,aAAarB,gBAAgBsB,aAAhB,EAAjB;AACA,gBAAIC,cAAcvB,gBAAgBwB,cAAhB,EAAlB;AACAb,kBAAMC,QAAN,CAAea,mBAAf,CAAmCJ,UAAnC,EAA+C,KAAKN,MAApD,EAA4D,KAAKA,MAAjE,EAAyEQ,WAAzE,EAAsF,KAAKG,aAAL,CAAmBhB,IAAnB,CAAwB,IAAxB,CAAtF;AACH,SALD,MAOA;AACI,iBAAKiB,SAAL;AACH;AACJ,KA3DI;AA6DLD,iBA7DK,yBA6DSP,QA7DT,EA8DL;AACI,YAAI,CAACA,SAASC,KAAd,EACA;AACI,iBAAKO,SAAL;AACH,SAHD,MAKA;AACI;AACH;AACJ,KAvEI;AAyELA,aAzEK,uBA0EL;AACI,YAAIC,UAAU5B,gBAAgB6B,YAAhB,EAAd;AACAlB,cAAMC,QAAN,CAAekB,gBAAf,CAAgC,SAAhC,EAA2CF,OAA3C,EAAoD,KAAKG,mBAAL,CAAyBrB,IAAzB,CAA8B,IAA9B,CAApD;AACH,KA7EI;AA+ELqB,uBA/EK,+BA+EeZ,QA/Ef,EAgFL;AACIa,gBAAQC,GAAR,CAAYd,QAAZ;AACA,YAAI,CAACA,SAASC,KAAd,EACA;AACI,iBAAKc,aAAL;AACH;AACJ,KAtFI;AAwFLA,iBAxFK,2BAwFW;AAChB;AACIC,gBAAQvB,QAAR,CAAiBwB,aAAjB,CAA+B,KAAKC,aAAL,CAAmB3B,IAAnB,CAAwB,IAAxB,CAA/B;AACH,KA3FI;AA6FL2B,iBA7FK,2BA8FL;AACIjD,WAAGkD,QAAH,CAAYC,YAAZ,CAAyB,MAAzB,EAAiC,KAAKC,QAAtC;AACA,aAAK/C,UAAL,CAAgBqB,QAAhB,GAA2B,CAA3B;AACH,KAjGI;AAmGL0B,YAnGK,sBAoGL;AACIpD,WAAGkD,QAAH,CAAYG,SAAZ,CAAsB,MAAtB;AACH;AAtGI,CAAT","file":"Boot.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        loadingBar: cc.ProgressBar,\r\n        username: cc.EditBox,\r\n        login: cc.Button,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    start () {\r\n        if(FBInstantHelper.isReady()) {\r\n            this.login.node.active = false;\r\n            this.username.node.active = false;\r\n            this.startLoading();\r\n        }\r\n    },\r\n\r\n    loginButtonPressed() {\r\n        this.startLoading();\r\n    },\r\n\r\n    startLoading()\r\n    {\r\n        this.loadResource();\r\n    },\r\n\r\n    loadResource()\r\n    {\r\n        ImageCache.Init(this.InitGameSpark.bind(this));\r\n    },\r\n\r\n    InitGameSpark()\r\n    {\r\n        GSMgr.instance.Init(this.LoginServer.bind(this));\r\n        this.loadingBar.progress = 0.6;\r\n    },\r\n\r\n    LoginServer()\r\n    {      \r\n        this.userId = this.username.string; //FBInstantHelper.getPlayerID();\r\n        GSMgr.instance.authenticationRequest(this.userId, this.userId, this.OnTryLogin.bind(this));\r\n    },\r\n\r\n    OnTryLogin(response)\r\n    {\r\n        if (response.error)\r\n        {\r\n            let playerName = FBInstantHelper.getPlayerName();\r\n            let playerPhoto = FBInstantHelper.getPlayerPhoto();\r\n            GSMgr.instance.registrationRequest(playerName, this.userId, this.userId, playerPhoto, this.OnTryRegister.bind(this));\r\n        }\r\n        else\r\n        {\r\n            this.EnterRoom();\r\n        }\r\n    },\r\n\r\n    OnTryRegister(response)\r\n    {\r\n        if (!response.error)\r\n        {\r\n            this.EnterRoom();\r\n        }\r\n        else\r\n        {\r\n            //pop up error\r\n        }\r\n    },\r\n\r\n    EnterRoom()\r\n    {\r\n        var groupId = FBInstantHelper.getContextID();\r\n        GSMgr.instance.enterRoomRequest(\"Kill_13\", groupId, this.onEnterRoomResponse.bind(this));\r\n    },\r\n\r\n    onEnterRoomResponse(response)\r\n    {\r\n        console.log(response);\r\n        if (!response.error)\r\n        {\r\n            this.WaitMatchData();\r\n        }\r\n    },\r\n\r\n    WaitMatchData() //it's sent automatically when user enter room\r\n    {\r\n        GameMgr.instance.onMatchLoaded(this.LoadGameScene.bind(this));\r\n    },\r\n\r\n    LoadGameScene()\r\n    {\r\n        cc.director.preloadScene(\"Game\", this.Finished);\r\n        this.loadingBar.progress = 1;\r\n    },\r\n\r\n    Finished()\r\n    {\r\n        cc.director.loadScene(\"Game\");\r\n    }\r\n});\r\n"]}