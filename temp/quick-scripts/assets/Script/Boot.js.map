{"version":3,"sources":["Boot.js"],"names":["cc","Class","extends","Component","properties","loadingBar","ProgressBar","username","EditBox","login","Button","start","FBInstantHelper","isReady","node","active","startLoading","loginButtonPressed","loadResource","ImageCache","Init","InitGameSpark","bind","GSMgr","instance","LoginServer","progress","userId","string","authenticationRequest","OnTryLogin","response","error","playerName","getPlayerName","playerPhoto","getPlayerPhoto","registrationRequest","OnTryRegister","EnterRoom","groupId","getContextID","enterRoomRequest","onEnterRoomResponse","console","log","WaitMatchData","GameMgr","onMatchLoaded","LoadGameScene","director","preloadScene","Finished","loadScene"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,oBAAYL,GAAGM,WADP;AAERC,kBAAUP,GAAGQ,OAFL;AAGRC,eAAOT,GAAGU;AAHF,KAHP;;AASL;;AAEA;;AAEAC,SAbK,mBAaI;AACL,YAAGC,gBAAgBC,OAAhB,EAAH,EAA8B;AAC1B,iBAAKJ,KAAL,CAAWK,IAAX,CAAgBC,MAAhB,GAAyB,KAAzB;AACA,iBAAKR,QAAL,CAAcO,IAAd,CAAmBC,MAAnB,GAA4B,KAA5B;AACA,iBAAKC,YAAL;AACH;AACJ,KAnBI;AAqBLC,sBArBK,gCAqBgB;AACjB,aAAKD,YAAL;AACH,KAvBI;AAyBLA,gBAzBK,0BA0BL;AACI,aAAKE,YAAL;AACH,KA5BI;AA8BLA,gBA9BK,0BA+BL;AACIC,mBAAWC,IAAX,CAAgB,KAAKC,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAAhB;AACH,KAjCI;AAmCLD,iBAnCK,2BAoCL;AACIE,cAAMC,QAAN,CAAeJ,IAAf,CAAoB,KAAKK,WAAL,CAAiBH,IAAjB,CAAsB,IAAtB,CAApB;AACA,aAAKjB,UAAL,CAAgBqB,QAAhB,GAA2B,GAA3B;AACH,KAvCI;AAyCLD,eAzCK,yBA0CL;AACI,aAAKE,MAAL,GAAc,KAAKpB,QAAL,CAAcqB,MAA5B,CADJ,CACwC;AACpCL,cAAMC,QAAN,CAAeK,qBAAf,CAAqC,KAAKF,MAA1C,EAAkD,KAAKA,MAAvD,EAA+D,KAAKG,UAAL,CAAgBR,IAAhB,CAAqB,IAArB,CAA/D;AACH,KA7CI;AA+CLQ,cA/CK,sBA+CMC,QA/CN,EAgDL;AACI,YAAIA,SAASC,KAAb,EACA;AACI,gBAAIC,aAAarB,gBAAgBsB,aAAhB,EAAjB;AACA,gBAAIC,cAAcvB,gBAAgBwB,cAAhB,EAAlB;AACAb,kBAAMC,QAAN,CAAea,mBAAf,CAAmCJ,UAAnC,EAA+C,KAAKN,MAApD,EAA4D,KAAKA,MAAjE,EAAyEQ,WAAzE,EAAsF,KAAKG,aAAL,CAAmBhB,IAAnB,CAAwB,IAAxB,CAAtF;AACH,SALD,MAOA;AACI,iBAAKiB,SAAL;AACH;AACJ,KA3DI;AA6DLD,iBA7DK,yBA6DSP,QA7DT,EA8DL;AACI,YAAI,CAACA,SAASC,KAAd,EACA;AACI,iBAAKO,SAAL;AACH,SAHD,MAKA;AACI;AACH;AACJ,KAvEI;AAyELA,aAzEK,uBA0EL;AACI,YAAIC,UAAU5B,gBAAgB6B,YAAhB,EAAd;AACAlB,cAAMC,QAAN,CAAekB,gBAAf,CAAgC,SAAhC,EAA2CF,OAA3C,EAAoD,KAAKG,mBAAL,CAAyBrB,IAAzB,CAA8B,IAA9B,CAApD;AACH,KA7EI;AA+ELqB,uBA/EK,+BA+EeZ,QA/Ef,EAgFL;AACIa,gBAAQC,GAAR,CAAYd,QAAZ;AACA,YAAI,CAACA,SAASC,KAAd,EACA;AACI,iBAAKc,aAAL;AACH;AACJ,KAtFI;AAwFLA,iBAxFK,2BAwFW;AAChB;AACIC,gBAAQvB,QAAR,CAAiBwB,aAAjB,CAA+B,KAAKC,aAAL,CAAmB3B,IAAnB,CAAwB,IAAxB,CAA/B;AACH,KA3FI;AA6FL2B,iBA7FK,2BA8FL;AACIjD,WAAGkD,QAAH,CAAYC,YAAZ,CAAyB,MAAzB,EAAiC,KAAKC,QAAtC;AACA,aAAK/C,UAAL,CAAgBqB,QAAhB,GAA2B,CAA3B;AACH,KAjGI;AAmGL0B,YAnGK,sBAoGL;AACIpD,WAAGkD,QAAH,CAAYG,SAAZ,CAAsB,MAAtB;AACH;AAtGI,CAAT","file":"Boot.js","sourceRoot":"../../../../assets/Script","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        loadingBar: cc.ProgressBar,\n        username: cc.EditBox,\n        login: cc.Button,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n        if(FBInstantHelper.isReady()) {\n            this.login.node.active = false;\n            this.username.node.active = false;\n            this.startLoading();\n        }\n    },\n\n    loginButtonPressed() {\n        this.startLoading();\n    },\n\n    startLoading()\n    {\n        this.loadResource();\n    },\n\n    loadResource()\n    {\n        ImageCache.Init(this.InitGameSpark.bind(this));\n    },\n\n    InitGameSpark()\n    {\n        GSMgr.instance.Init(this.LoginServer.bind(this));\n        this.loadingBar.progress = 0.6;\n    },\n\n    LoginServer()\n    {      \n        this.userId = this.username.string; //FBInstantHelper.getPlayerID();\n        GSMgr.instance.authenticationRequest(this.userId, this.userId, this.OnTryLogin.bind(this));\n    },\n\n    OnTryLogin(response)\n    {\n        if (response.error)\n        {\n            let playerName = FBInstantHelper.getPlayerName();\n            let playerPhoto = FBInstantHelper.getPlayerPhoto();\n            GSMgr.instance.registrationRequest(playerName, this.userId, this.userId, playerPhoto, this.OnTryRegister.bind(this));\n        }\n        else\n        {\n            this.EnterRoom();\n        }\n    },\n\n    OnTryRegister(response)\n    {\n        if (!response.error)\n        {\n            this.EnterRoom();\n        }\n        else\n        {\n            //pop up error\n        }\n    },\n\n    EnterRoom()\n    {\n        var groupId = FBInstantHelper.getContextID();\n        GSMgr.instance.enterRoomRequest(\"Kill_13\", groupId, this.onEnterRoomResponse.bind(this));\n    },\n\n    onEnterRoomResponse(response)\n    {\n        console.log(response);\n        if (!response.error)\n        {\n            this.WaitMatchData();\n        }\n    },\n\n    WaitMatchData() //it's sent automatically when user enter room\n    {\n        GameMgr.instance.onMatchLoaded(this.LoadGameScene.bind(this));\n    },\n\n    LoadGameScene()\n    {\n        cc.director.preloadScene(\"Game\", this.Finished);\n        this.loadingBar.progress = 1;\n    },\n\n    Finished()\n    {\n        cc.director.loadScene(\"Game\");\n    }\n});\n"]}