{"version":3,"sources":["Boot.js"],"names":["cc","Class","extends","Component","properties","loadingBar","ProgressBar","username","EditBox","login","Button","start","userId","FBInstantHelper","isReady","node","active","startLoading","progressPercent","nextProgressPercent","loginButtonClick","quickLoginButtonClick","sender","id","loadResource","ImageCache","Init","LoadSoundGame","bind","SoundMgr","instance","preload","LoadGameScene","director","preloadScene","InitGameSpark","GSMgr","LoginServer","getPlayerID","string","authenticationRequest","OnTryLogin","response","error","playerName","getPlayerName","playerPhoto","getPlayerPhoto","registrationRequest","OnTryRegister","EnterRoom","groupId","getContextID","enterRoomRequest","onEnterRoomResponse","console","log","WaitMatchData","GameMgr","onMatchLoaded","Finished","loadScene","update","dt","progress"],"mappings":"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","file":"Boot.js","sourceRoot":"../../../../assets/Script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        loadingBar: cc.ProgressBar,\r\n        username: cc.EditBox,\r\n        login: cc.Button,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    start () {\r\n        this.userId = '';\r\n        if(FBInstantHelper.isReady()) {\r\n            this.login.node.active = false;\r\n            this.username.node.active = false;\r\n            this.startLoading();\r\n        }\r\n        this.progressPercent = 0;\r\n        this.nextProgressPercent = 0;\r\n    },\r\n\r\n    loginButtonClick() {\r\n        this.startLoading();\r\n    },\r\n\r\n    quickLoginButtonClick(sender, id) {\r\n        this.startLoading();\r\n        this.userId = id;\r\n    },\r\n\r\n    startLoading()\r\n    {\r\n        this.loadResource();\r\n    },\r\n\r\n    loadResource()\r\n    {\r\n        ImageCache.Init(this.LoadSoundGame.bind(this));\r\n        this.nextProgressPercent = 0.3;\r\n    },\r\n\r\n    LoadSoundGame()\r\n    {\r\n        SoundMgr.instance.preload(this.LoadGameScene.bind(this));\r\n        this.nextProgressPercent = 0.5;\r\n    },\r\n\r\n    LoadGameScene()\r\n    {\r\n        cc.director.preloadScene(\"Game\", this.InitGameSpark.bind(this));\r\n        this.nextProgressPercent = 0.8;\r\n    },\r\n\r\n    InitGameSpark()\r\n    {\r\n        GSMgr.instance.Init(this.LoginServer.bind(this));\r\n        this.nextProgressPercent = 0.9;\r\n    },\r\n\r\n    LoginServer()\r\n    {      \r\n        if(FBInstantHelper.isReady()) {\r\n            this.userId = FBInstantHelper.getPlayerID();\r\n        } else {\r\n            if(this.userId == '') {\r\n                this.userId = this.username.string;\r\n            }\r\n        }\r\n        GSMgr.instance.authenticationRequest(this.userId, this.userId, this.OnTryLogin.bind(this));\r\n    },\r\n\r\n    OnTryLogin(response)\r\n    {\r\n        if (response.error)\r\n        {\r\n            let playerName = FBInstantHelper.getPlayerName();\r\n            let playerPhoto = FBInstantHelper.getPlayerPhoto();\r\n            if(playerName == \"Mayc\") \r\n            {\r\n                playerName = this.userId;\r\n            }\r\n            GSMgr.instance.registrationRequest(playerName, this.userId, this.userId, playerPhoto, this.OnTryRegister.bind(this));\r\n        }\r\n        else\r\n        {\r\n            this.EnterRoom();\r\n        }\r\n    },\r\n\r\n    OnTryRegister(response)\r\n    {\r\n        if (!response.error)\r\n        {\r\n            this.EnterRoom();\r\n        }\r\n        else\r\n        {\r\n            //pop up error\r\n        }\r\n    },\r\n\r\n    EnterRoom()\r\n    {\r\n        var groupId = FBInstantHelper.getContextID();\r\n        GSMgr.instance.enterRoomRequest(\"Kill_13\", groupId, this.onEnterRoomResponse.bind(this));\r\n    },\r\n\r\n    onEnterRoomResponse(response)\r\n    {\r\n        console.log(response);\r\n        this.nextProgressPercent = 1;\r\n        if (!response.error)\r\n        {\r\n            this.WaitMatchData();\r\n        }\r\n    },\r\n\r\n    WaitMatchData() //it's sent automatically when user enter room\r\n    {\r\n        GameMgr.instance.onMatchLoaded(this.Finished.bind(this));\r\n    },\r\n\r\n    Finished()\r\n    {\r\n        cc.director.loadScene(\"Game\");\r\n    },\r\n\r\n    update(dt)\r\n    {\r\n        if (this.progressPercent < this.nextProgressPercent)\r\n        {\r\n            this.progressPercent += dt;\r\n            this.loadingBar.progress = this.progressPercent;\r\n        }\r\n    }\r\n});\r\n"]}