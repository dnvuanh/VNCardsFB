{"version":3,"sources":["SeatMgr.js"],"names":["cc","Class","extends","Component","properties","start","seats","GameMgr","instance","getCurrentSeats","seat","playerId","playerInfo","getPlayer","onPlayerEnter","host","getHost","setHost","cachedPlayersPos","cachedResultPos","cachedCardsPos","i","node","children","length","position","getChildByName","seatDisplay","getComponent","display","IsMyId","id","RotateSeats","mySeat","Notification","add","offset","movePosition","moveTo","runAction","cardsNode","resultNode","angle","setPosition","onPlayerLeave","remove","getPlayerId","onTurnChange","startTime","timeout","displayTurn","disableCountDown","stopAllTurn","displayResult","playerWinId","playersCards","cards","bInstantWin","displayWinResult","displayLoseResult","hideResultIcon","RecallCards","onPlayerReady","isReady","setReady"],"mappings":"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","file":"SeatMgr.js","sourceRoot":"../../../../../assets/Script/UI","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n    \n    start()\n    {\n        let seats = GameMgr.instance.getCurrentSeats();\n        for (var seat in seats)\n        {\n            let playerId = seats[seat];\n            if (playerId)\n            {\n                let playerInfo = GameMgr.instance.getPlayer(playerId);\n                this.onPlayerEnter(playerInfo, seat);\n            }\n        }\n        let host = GameMgr.instance.getHost();\n        if (host)\n            this.setHost(host);\n\n        this.cachedPlayersPos = [];\n        this.cachedResultPos = [];\n        this.cachedCardsPos = [];\n        for (let i=0; i<this.node.children.length; i++)\n        {\n            this.cachedPlayersPos[i] = this.node.children[i].position;\n            this.cachedResultPos[i] = this.node.children[i].getChildByName(\"display\").getChildByName(\"ResultIcon\").position;\n            this.cachedCardsPos[i] = this.node.children[i].getChildByName(\"display\").getChildByName(\"cards\").position;\n        }\n    },\n\n    onPlayerEnter(playerInfo, seat)\n    {\n        if (seat < this.node.children.length)\n        {\n            var seatDisplay = this.node.children[seat].getComponent(\"SeatDisplay\");\n                seatDisplay.display(playerInfo);\n        }\n        if (GameMgr.instance.IsMyId(playerInfo.id))\n        {\n            this.RotateSeats(seat);\n        }\n    },\n\n    RotateSeats(mySeat)\n    {\n        Notification.instance.add(\"Moving Player Position\");\n        for (let i=0; i < this.node.children.length; i++)\n        {\n            let offset = (i - mySeat) >= 0 ? (i - mySeat) : (i - mySeat + 4);\n            /*let fadeOut = cc.fadeOut(0.2);\n            let movePosition = cc.callFunc(() => this.node.children[i].position = this.cachedPlayersPos[offset]);\n            let fadeIn = cc.fadeIn(0.2);\n            this.node.children[i].runAction(cc.sequence(fadeOut, cc.delayTime(0.1), movePosition, fadeIn));*/\n            var movePosition = cc.moveTo(0.5,this.cachedPlayersPos[offset]);\n            this.node.children[i].runAction(movePosition);\n            var cardsNode = this.node.children[i].getChildByName(\"display\").getChildByName(\"cards\");\n            var resultNode = this.node.children[i].getChildByName(\"display\").getChildByName(\"ResultIcon\");\n            cardsNode.angle = 90 * (offset % 2);\n            cardsNode.setPosition(this.cachedCardsPos[offset]);\n            resultNode.setPosition(this.cachedResultPos[offset]);\n        }\n    },\n\n    onPlayerLeave(seat)\n    {\n        if (seat < this.node.children.length)\n        {\n            var seatDisplay = this.node.children[seat].getComponent(\"SeatDisplay\");\n                seatDisplay.remove();\n        }\n    },\n\n    setHost(playerId)\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\n            {\n                seatDisplay.setHost(true);\n            }\n            else\n            {\n                seatDisplay && seatDisplay.setHost(false);\n            }\n        }\n    },\n\n    onTurnChange(playerId, startTime, timeout)\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\n            {\n                seatDisplay.displayTurn(startTime, timeout);\n            }\n            else\n            {\n                seatDisplay.disableCountDown();\n            }\n        }\n    },\n\n    stopAllTurn()\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n                seatDisplay.disableCountDown();\n        }\n    },\n\n    displayResult(playerWinId, playersCards)\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n            if (seatDisplay && seatDisplay.getPlayerId() != null)\n            {\n                var cards = playersCards[seatDisplay.getPlayerId()];\n                var bInstantWin = playersCards[playerWinId].length == 13;\n                if(seatDisplay.getPlayerId() == playerWinId)\n                {\n                    seatDisplay.displayWinResult(bInstantWin, cards);\n                }\n                else \n                {\n                    seatDisplay.displayLoseResult(bInstantWin, cards);\n                }\n            }\n        }\n    },\n\n    hideResultIcon()\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n            seatDisplay.hideResultIcon();\n            if (seatDisplay && seatDisplay.getPlayerId() != null)\n            {\n                seatDisplay.RecallCards();\n            }\n        }\n    },\n\n    onPlayerReady(playerId, isReady)\n    {\n        for (var i=0; i<this.node.children.length; i++)\n        {\n            var seatDisplay = this.node.children[i].getComponent(\"SeatDisplay\");\n            if (seatDisplay && seatDisplay.getPlayerId() == playerId)\n            {\n                seatDisplay.setReady(isReady);\n            }\n        }\n    }\n    \n});\n"]}